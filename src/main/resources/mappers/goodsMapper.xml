<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.mappers.goodsMapper">
	<select id="goodsList" resultType="com.project.domain.GoodsDTO">
		select * from goods
		<if test="G_code!=null">
			where G_code=#{G_code}
		</if>
	</select>

	<select id="goodsDetail" resultType="com.project.domain.GoodsDTO">
		select * from goods
		where G_code=#{G_code}
	</select>

	<select id="basketList" resultType="com.project.domain.BasketDTO">
		select b.G_code, G_imgS, G_product, G_price, B_count, G_stop from goods g join basket b on g.G_code=b.G_code
		where U_id=#{id}
		order by B_date
	</select>

	<insert id="basketAdd">
		insert basket(B_num, U_id, G_code, B_count)
		values(#{B_num}, #{U_id}, #{G_code}, #{B_count})
	</insert>
	
	<update id="basketUpdate">
		update basket set B_count=#{B_count} where U_id=#{U_id} and G_code=#{G_code}
	</update>
	
	<select id="basketAllPrice" resultType="java.lang.Integer">
		select sum(G_price*B_count) from basket b join Goods g on b.G_code=g.G_code where U_id=#{id}
	</select>

	<insert id="goodsWrite">
		insert into goods(G_code, G_stop, G_product, G_price, G_desc, G_imgS, G_img)
		values(#{G_code}, #{G_stop}, #{G_product}, #{G_price}, #{G_desc}, #{G_imgS}, #{G_img})
	</insert>
	
	<select id="maxB_num" resultType="java.lang.Integer">
		select max(B_num) from basket
	</select>
	
	<select id="maxB_count" resultType="java.lang.Integer">
		select max(B_count) from basket where U_id=#{U_id} and G_code=#{G_code}
	</select>
	
	<select id="getG_code" resultType="java.lang.String">
		select G_code from basket
		where U_id=#{U_id} and G_code=#{G_code}
	</select>
</mapper>